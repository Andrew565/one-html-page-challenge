<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>The Game of Crag</title>

    <style>
      body {
        font-size: 16px;
      }

      .diceRow {
        display: flex;
        width: 100%;
        justify-content: space-around;
        margin: 2em 0;
      }

      .diceRow span {
        font-size: 3em !important;
      }

      .scoreCardTable {
        width: 100%;
      }

      .scoreCardTable th:first-of-type {
        text-align: left;
      }

      .scoreCardCell {
        text-align: center;
      }

      .scoreCardCell:first-of-type {
        text-align: left;
      }

      span[class^="die"] {
        font-size: 28px;
      }

      .die1::before {
        content: "\2680";
      }

      .die2::before {
        content: "\2681";
      }

      .die3::before {
        content: "\2682";
      }

      .die4::before {
        content: "\2683";
      }

      .die5::before {
        content: "\2684";
      }

      .die6::before {
        content: "\2685";
      }
      
      *[class$="--selected"] {
        border: 1px solid red;
      }
      
      *[class$="--locked"] {
        border: 1px solid rebeccapurple;
      }
    </style>
  </head>
  <body>
    <h1>The Game of Crag</h1>

    <p class="introduction">
      Someone named Pascal Claisse made a wonderful one-html-page entry for the German game kniffel (a precursor to
      Yahtzee) which he called <a href="/knfl.html">KNFL</a>. In researching that game on Wikipedia, I came across a
      similar and even simpler game called <a href="https://en.wikipedia.org/wiki/Crag_(dice_game)">Crag</a>. I loved
      the simplicity of the game, and the fact it used only 3 dice (I'm a sucker for minimalism). What sealed the deal
      for me, though, is the fact that my brother's name is Craig (a gaelic-styled version of Crag). So, I present this
      in his honor.
    </p>

    <div id="GameContainer">
      <div id="GameField">
        <section id="DiceRow" class="diceRow">
          <div id="Die0" class="die"><span class="die1"></span></div>
          <div id="Die1" class="die"><span class="die1"></span></div>
          <div id="Die2" class="die"><span class="die1"></span></div>
        </section>
        <section id="PlayerStats"><span id="PlayerName">Player</span><span id="CurrentScore"></span></section>
      </div>
      <table id="GameScoreCard" class="scoreCard">
        <thead>
          <th>Category</th>
          <th>Description</th>
          <th>Points</th>
          <th>Score</th>
        </thead>
        <tbody>
          <tr id="ScoreCardOnes">
            <td class="scoreCard__categoryCell">Ones</td>
            <td class="scoreCard__descriptionCell">0 or more <span class="die1"></span>s</td>
            <td class="scoreCard__pointsCell">Sum of <span class="die1"></span>s</td>
            <td class="scoreCard__scoreCell">--</td>
          </tr>
          <tr id="ScoreCardTwos">
            <td class="scoreCard__categoryCell">Twos</td>
            <td class="scoreCard__descriptionCell">0 or more <span class="die2"></span>s</td>
            <td class="scoreCard__pointsCell">Sum of <span class="die2"></span>s</td>
            <td class="scoreCard__scoreCell">--</td>
          </tr>
          <tr id="ScoreCardThrees">
            <td class="scoreCard__categoryCell">Threes</td>
            <td class="scoreCard__descriptionCell">0 or more <span class="die3"></span>s</td>
            <td class="scoreCard__pointsCell">Sum of <span class="die3"></span>s</td>
            <td class="scoreCard__scoreCell">--</td>
          </tr>
          <tr id="ScoreCardFours">
            <td class="scoreCard__categoryCell">Fours</td>
            <td class="scoreCard__descriptionCell">0 or more <span class="die4"></span>s</td>
            <td class="scoreCard__pointsCell">Sum of <span class="die4"></span>s</td>
            <td class="scoreCard__scoreCell">--</td>
          </tr>
          <tr id="ScoreCardFives">
            <td class="scoreCard__categoryCell">Fives</td>
            <td class="scoreCard__descriptionCell">0 or more <span class="die5"></span>s</td>
            <td class="scoreCard__pointsCell">Sum of <span class="die5"></span>s</td>
            <td class="scoreCard__scoreCell">--</td>
          </tr>
          <tr id="ScoreCardSixes">
            <td class="scoreCard__categoryCell">Sixes</td>
            <td class="scoreCard__descriptionCell">0 or more <span class="die6"></span>s</td>
            <td class="scoreCard__pointsCell">Sum of <span class="die6"></span>s</td>
            <td class="scoreCard__scoreCell">--</td>
          </tr>
          <tr id="ScoreCardOddStraight">
            <td class="scoreCard__categoryCell">Odd Straight</td>
            <td class="scoreCard__descriptionCell"><span class="die1"></span>, <span class="die3"></span>, <span class="die5"></span></td>
            <td class="scoreCard__pointsCell">20</td>
            <td class="scoreCard__scoreCell">--</td>
          </tr>
          <tr id="ScoreCardEvenStraight">
            <td class="scoreCard__categoryCell">Even Straight</td>
            <td class="scoreCard__descriptionCell"><span class="die2"></span>, <span class="die4"></span>, <span class="die6"></span></td>
            <td class="scoreCard__pointsCell">20</td>
            <td class="scoreCard__scoreCell">--</td>
          </tr>
          <tr id="ScoreCardLowStraight">
            <td class="scoreCard__categoryCell">Low Straight</td>
            <td class="scoreCard__descriptionCell"><span class="die1"></span>, <span class="die2"></span>, <span class="die3"></span></td>
            <td class="scoreCard__pointsCell">20</td>
            <td class="scoreCard__scoreCell">--</td>
          </tr>
          <tr id="ScoreCardHighStraight">
            <td class="scoreCard__categoryCell">High Straight</td>
            <td class="scoreCard__descriptionCell"><span class="die4"></span>, <span class="die5"></span>, <span class="die6"></span></td>
            <td class="scoreCard__pointsCell">20</td>
            <td class="scoreCard__scoreCell">--</td>
          </tr>
          <tr id="ScoreCardThreeOfAKind">
            <td class="scoreCard__categoryCell">Three of a Kind</td>
            <td class="scoreCard__descriptionCell">Any three dice of the same value<br/>(3 <span class="die4"></span>s, 3 <span class="die2"></span>s, etc.)</td>
            <td class="scoreCard__pointsCell">25</td>
            <td class="scoreCard__scoreCell">--</td>
          </tr>
          <tr id="ScoreCardThirteen">
            <td class="scoreCard__categoryCell">Thirteen</td>
            <td class="scoreCard__descriptionCell"><span class="die2"></span>, <span class="die5"></span>, <span class="die6"></span><br/>or  <span class="die3"></span>, <span class="die4"></span>, <span class="die6"></span></td>
            <td class="scoreCard__pointsCell">26</td>
            <td class="scoreCard__scoreCell">--</td>
          </tr>
          <tr id="ScoreCardCrag">
            <td class="scoreCard__categoryCell">Crag</td>
            <td class="scoreCard__descriptionCell"><span class="die1"></span>, <span class="die6"></span>, <span class="die6"></span>, or <span class="die3"></span>, <span class="die5"></span>, <span class="die5"></span>,<br/>or <span class="die5"></span>, <span class="die4"></span>, <span class="die4"></span></td>
            <td class="scoreCard__pointsCell">50</td>
            <td class="scoreCard__scoreCell">--</td>
          </tr>
        </tbody>
      </table>
      <div id="ActionButtons">
        <button id="RollDiceButton">Roll Dice</button>
        <button id="EndTurnButton">End Turn</button>
      </div>
    </div>

    <script>
      const C = {
        dieDivClass: "die",
        electedDieDivClass: "die--selected",
        scoreCellClass: "scoreCard__scoreCell",
        selectedScoreCellClass: "scoreCard__scoreCell--selected",
        lockedScoreCellClass: "scoreCard__scoreCell--locked"
      };
      
      const Game = {
        players: [],
        rollTwo: false,
        set updateRoll () {
          this.rollTwo = !this.rollTwo;
          if (this.rollTwo) {
            RollDiceButton.setAttribute("disabled", true);
          } else {
            RollDiceButton.removeAttribute("disabled");
          }
        }
      }
    
      const Dice = [
        { id: 0, value: 1, selected: false },
        { id: 1, value: 1, selected: false },
        { id: 2, value: 1, selected: false }
      ];
      
      const SimpleCategoriesAndValues = [
        {category: "Ones", value: 1, selected: false, locked: false, finalValue: 0},
        {category: "Twos", value: 2, selected: false, locked: false, finalValue: 0},
        {category: "Threes", value: 3, selected: false, locked: false, finalValue: 0},
        {category: "Fours", value: 4, selected: false, locked: false, finalValue: 0},
        {category: "Fives", value: 5, selected: false, locked: false, finalValue: 0},
        {category: "Sixes", value: 6, selected: false, locked: false, finalValue: 0}
      ];
      
      const ComplexCategories = [
        {category: "OddStraight", needed: [[1, 3, 5]], value: 20},
        {category: "EvenStraight", needed: [[2, 4, 6]], value: 20},
        {category: "LowStraight", needed:[[1, 2, 3]], value: 20},
        {category: "HighStraight", needed: [[4, 5, 6]], value: 20},
        {category: "ThreeOfAKind", needed: [[1,1,1], [2,2,2], [3,3,3], [4,4,4], [5,5,5], [6,6,6]], value: 25},
        {category: "Thirteen", needed: [[2,5,6], [3,4,6]], value: 26},
        {category: "Crag", needed: [[1, 6, 6], [3, 5, 5], [4, 4, 5]], value: 50}
      ];

      const pickOf6 = () => {
        return Math.floor(Math.random() * 6) + 1;
      };
      
      const getById = (id) => document.getElementById(id);
      const getByQuery = (q) => document.querySelector(q);
      
      HTMLElement.prototype.hasClass = (className) => this.classList.contains(className);
      
      const diceDivs = document.getElementsByClassName("die");
      for (let dieDiv of diceDivs) {
        dieDiv.addEventListener("click", () => {
          dieDiv.classList.toggle("selected");
          const id = dieDiv.id.replace('Die', '');
          Dice[id].selected = !Dice[id].selected;
        });
      }
      
      const scoreCells = document.getElementsByClassName(C.scoreCellClass);
      const selectedCells = document.getElementsByClassName(C.selectedScoreCellClass);
      const lockedCells = document.getElementsByClassName(C.lockedScoreCellClass)

      const RollDiceButton = getById("RollDiceButton");
      RollDiceButton.addEventListener("click", () => {
        Dice.forEach(die => {
          if (!die.selected && !die.locked) die.value = pickOf6();
        });
        updateDiceDisplay();
        updateScoreCard();
        Game.updateRoll();
      });

      const updateDiceDisplay = () => {
        Dice.forEach(die => {
          const dieEl = getByQuery(`#Die${die.id} span`);
          dieEl.classList.value = `die${die.value}`;
        });
      };
      
      const updateCellScore = (category, value) => {
        const cell = getByQuery(`#ScoreCard${category} .${C.scoreCellClass}`);
        cell.innerHTML = String(value);
      };
      
      const updateSimple = ({category, value}) => {
        const catDice = Dice.filter((die) => die.value === value);
        if (catDice.length > 0) {
          updateCellScore(category, catDice.length * value);
        }
      };
      
      const updateComplex = ({category, needed, value}) => {
        let matches = 0;
        
        for (const need in needed) {
          for (const die in Dice) {
            if (die.value === need) {
              matches++;
            }
          }
        }
        
        if (matches === 3) {
          updateCellScore(die.category, value);
        }
      };
      
      const updateScoreCard = () => {
        SimpleCategoriesAndValues.forEach(updateSimple);
        ComplexCategories.forEach(updateComplex);
      };
      
      for (let scoreCell of scoreCells) {
        scoreCell.addEventListener("click", () => {
          // Don't do anything if this cell is already locked
          if (scoreCell.hasClass(C.lockedScoreCellClass)) return;
          
          scoreCell.classList.toggle(C.selectedScoreCellClass);
        });
      }
      
      const endTurnButton = getById("EndTurnButton");
      endTurnButton.addEventListener("click", () => {
        // Check to make sure something valid was selected
        const valid = validateSelection();
        if (!valid) return;
        
        // Add the points to the total score
        
        // Check to see if there are any more slots available (i.e. can the player take another turn, or is the game over?)
        
        // If they can take another turn, reset whatever needs resetting for the next turn
        
        // If the game is over, display a message (modal or alert) stating their final score and ask if they wish to play again
      });
      
      const validateSelection = () => {
        if (selectedCells.length !== 1) {
          // TODO: Display an error message - there can be only one 
          return;
        }
        
        if (selectedCells[0].classList.contains(C.lockedScoreCellClass)) {
          // TODO: Display an error message - you cannot select a cell
          return;
        }
        
        
      }
    </script>
  </body>
</html>
